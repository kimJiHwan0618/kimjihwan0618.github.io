---
layout: single
title: "[DB] íŠ¸ëœì­ì…˜(Transaction)ì´ë€?"
categories: "db"
tag: ["mariadb", "express", "javascript"]
typora-root-url: ../
description: íŠ¸ëœì­ì…˜(Transaction) ê°œë… ì„¤ëª…, íŠ¹ì§•, node js ì½”ë“œ ì ìš©
excerpt: "íŠ¸ëœì­ì…˜(Transaction) ê°œë… ì„¤ëª…, íŠ¹ì§•, node js ì½”ë“œ ì ìš©"
toc: true
toc_sticky: true
header:
  teaser: ../../assets/images/thumbnail/db.png
---

![DB ì¸ë„¤ì¼](../../assets/images/thumbnail/db.png)

### íŠ¸ëœì­ì…˜ Transaction ì´ë€ â“

íŠ¸ëœì­ì…•ì´ë€ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í•˜ë‚˜ì˜ ë…¼ë¦¬ì  ê¸°ëŠ¥ì—ì„œ ì‹¤í–‰ë˜ì–´ì§€ëŠ” ì—¬ëŸ¬ì‘ì—…ì˜ ë‹¨ìœ„ì´ë‹¤. ê°œë°œìì¤‘ì—ì„œëŠ” DBë§Œì„ ì¹­í•˜ëŠ”ê²Œ ì•„ë‹ˆì—¬ë„ í•˜ë‚˜ì˜ ê¸°ëŠ¥ì—ì„œ ë™ì‘í•˜ëŠ” ì—¬ëŸ¬ì‘ì—…ì„ íŠ¸ëœì­ì…˜ì´ë¼ê³  í•˜ëŠ” ì‚¬ëŒë„ ìˆë‹¤. DBê´€ì ì—ì„œ íŠ¸ëœì­ì…˜ì€ í¬ê²Œ 4ê°€ì§€ íŠ¹ì§•ì„ ê°–ëŠ”ë‹¤.

#### 1ï¸âƒ£ Atomicity (ì›ìì„±)

- íŠ¸ëœì­ì…˜ì´ DBì— ëª¨ë‘ ë°˜ì˜ë˜ê±°ë‚˜, í˜¹ì€ ì „í˜€ ë°˜ì˜ë˜ì§€ ì•Šì•„ì•¼ ëœë‹¤.

#### 2ï¸âƒ£ Consistency (ì¼ê´€ì„±)

- íŠ¸ëœì­ì…˜ì˜ ì‘ì—… ì²˜ë¦¬ ê²°ê³¼ëŠ” í•­ìƒ ì¼ê´€ì„± ìˆì–´ì•¼ í•œë‹¤.

#### 3ï¸âƒ£ Isolation (ë…ë¦½ì„±)

- ë‘˜ ì´ìƒì˜ íŠ¸ëœì­ì…˜ì´ ë™ì‹œì— ë³‘í–‰ ì‹¤í–‰ë˜ê³  ìˆì„ ë•Œ, ì–´ë–¤ íŠ¸ëœì­ì…˜ë„ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ ì—°ì‚°ì— ë¼ì–´ë“¤ ìˆ˜ ì—†ë‹¤.

#### 4ï¸âƒ£ Durability (ì§€ì†ì„±)

- íŠ¸ëœì­ì…˜ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìœ¼ë©´, ê²°ê³¼ëŠ” ì˜êµ¬ì ìœ¼ë¡œ ë°˜ì˜ë˜ì–´ì•¼ í•œë‹¤.

### í”„ë¡œì íŠ¸ ì ìš©í•´ë³´ê¸°(node.js)â—

ë‚˜ì˜ ê²½ìš°ì— <code>node.js</code> ì™€ <code>express</code> ë¡œ ë˜ìˆëŠ” ë°±ì—”ë“œ í”„ë¡œì íŠ¸ê°€ ìˆì—ˆë‹¤. API êµ¬í˜„ì¤‘ì— 2ê°œ ì´ìƒì˜ <code>DELETE</code>, <code>UPDATE</code>ë¬¸ì„ ì¼ê´„ì ìœ¼ë¡œ í•˜ë‚˜ì˜ APIì—ì„œ ì²˜ë¦¬í•´ì•¼í•˜ëŠ” ê²½ìš°ê°€ ìƒê²¼ëŠ”ë° .. ì´ì „ì—ëŠ” ëª°ë¼ì„œ ì ìš©í•˜ì§€ ëª»í–ˆëŠ”ë°, íŠ¸ëœì­ì…˜ì„ ì•Œê³ ë‚˜ë‹ˆ ê°œì„ í• ìˆ˜ ìˆê² ë‹¤ ì‹¶ì–´ì„œ ì ìš©í•´ë³´ê¸°ë¡œ í•˜ì˜€ë‹¤.

```javascript
const db = require(path.join(root, "config/db.config"));
const log4js = require("log4js");
const logger = log4js.getLogger("access");
const log4jsConfig = path.join(root, "config/log4js.config.json");
log4js.configure(log4jsConfig);

deleteWork: async (req, res) => {
  const connection = db();
  try {
    await connection.beginTransaction(); // íŠ¸ëœì­ì…˜ ì‹œì‘
    await connection.query(query.deleteWork(req.body)); // work ë°ì´í„° ì‚­ì œ
    await connection.query(query.updateWorkOrder(req.body)); // ì‚­ì œëœ work ê¸°ì¤€ order ì»¬ëŸ¼ ì¬ì •ë ¬
    await connection.commit(); // íŠ¸ëœì­ì…˜ ì»¤ë°‹
    const [works, error] = await connection.query(query.getWorks(popolSeq)); // works ë°ì´í„° ì¡°íšŒí›„ ë°˜í™˜
    res.status(200).send(rows);
  } catch (error) {
    await connection.rollback(); // ì‹¤íŒ¨ì‹œ ì‹¤í–‰ë¬ë˜ ì¿¼ë¦¬ë¬¸ ë¡¤ë°±
    logger.error("deleteWork error :", error);
    res.status(500).json({
      message: "deleteWork error : ë‚´ë¶€ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
      timestamp: new Date(),
    });
  } finally {
    await connection.end();
  }
};
```

ì´ì œ deleteì™€ updateì˜ ì—°ì†ëœ ì‹¤í–‰ì— ëŒ€í•´ ê²°ê³¼ë¥¼ ì¼ê´„ì ìœ¼ë¡œ ë³´ì¥ë°›ì„ìˆ˜ ìˆë‹¤ğŸ˜Š!
